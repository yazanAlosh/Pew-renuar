<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>סורק/חיפוש פריט + רנואר</title>
  <style>
    :root{--blue:#007bff;--blue2:#0056b3;--text:#222;--muted:#666;--bg:#ffffff;--card:#fff}
    *{box-sizing:border-box}html,body{margin:0;padding:0}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:var(--text);background:var(--bg);line-height:1.5}
    header{background:linear-gradient(90deg,var(--blue),var(--blue2));color:#fff;text-align:center;padding:16px 20px;box-shadow:0 2px 10px rgba(0,0,0,.12)}
    header h1{margin:6px 0 0;font-size:clamp(18px,2.6vw,26px)}
    .wrap{max-width:980px;margin:18px auto;padding:12px}
    .card{background:var(--card);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:clamp(14px,3vw,24px);margin-bottom:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:stretch}
    input[type=text]{flex:1;min-width:230px;padding:12px;border:1px solid #dcdcdc;border-radius:10px;font-size:16px;outline:0;box-shadow:inset 0 2px 4px rgba(0,0,0,.03)}
    input[type=text]:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(0,123,255,.12), inset 0 2px 4px rgba(0,0,0,.03)}
    button{background:var(--blue);color:#fff;border:0;border-radius:10px;padding:12px 18px;font-size:16px;font-weight:600;cursor:pointer;box-shadow:0 6px 16px rgba(0,123,255,.35);transition:background .2s,transform .05s}
    button:hover{background:var(--blue2)}button:active{transform:translateY(1px)}
    .ghost{background:#fff;color:var(--blue);border:1px solid #dcdcdc;box-shadow:none}
    .muted{color:var(--muted);font-size:14px;margin-top:6px}
    .ok{color:#118a2c;font-weight:700;margin-top:6px}
    .err{color:#c0392b;font-weight:700;margin-top:6px}
    iframe{width:100%;height:65vh;border:1px solid #eee;border-radius:10px;background:#fff;display:none;margin-top:10px}
    .linkbox{margin-top:8px;font-size:13px}
    .linkbox a{word-break:break-all}
  </style>
</head>
<body>
  <header><h1>סורק/חיפוש פריט + חיפוש באתר רנואר</h1></header>

  <main class="wrap">
    <section class="card">
      <div class="row">
        <input id="q" type="text" placeholder="הכנס שם פריט או מק״ט">
        <button type="button" onclick="checkPrice()">בדוק מחיר</button>
        <button type="button" class="ghost" onclick="searchInFrame()">חפש ברנואר (במסגרת)</button>
        <button type="button" class="ghost" onclick="openNew()">פתח בטאב חדש</button>
        <button type="button" class="ghost" onclick="openSame()">פתח באותו טאב</button>
        <button type="button" class="ghost" onclick="clearAll()">נקה</button>
      </div>
      <div id="msg" class="muted">טיפ: Enter يفحص السعر ويجهّز رابط البحث.</div>
      <div id="priceBox"></div>
      <div id="debugLink" class="linkbox muted"></div>
    </section>

    <section class="card">
      <strong>תוצאות באתר רנואר (במסגרת):</strong>
      <iframe id="renFrame" title="תוצאות חיפוש רנואר"></iframe>
      <div class="muted">אם לא מופיע בתוך המסגרת (חסימת IFRAME) استخدم "פתח בטאב جديد" أو "نفس التبويب".</div>
    </section>

    <section class="card">
      <strong>טבלת מחירים מקומית (عدّلها لما يناسب منتجاتك):</strong>
      <pre class="muted" style="white-space:pre-wrap;margin-top:8px">
مثال:
SKU: 111   | שם: חולצת בייסיק | ₪50
SKU: 222   | שם: מכנס ג׳ינס   | ₪75
SKU: 333   | שם: שמלת ערב     | ₪120
SKU: 444   | שם: מעיל חורף    | ₪200
      </pre>
    </section>
  </main>

  <script>
    // === جدول أسعار محلي: عدّله وأضف كل ال-SKU الحقيقيين وأسعارهم ===
    const CATALOG = [
      { sku: "111", name: "חולצת בייסיק", price: "₪50"  },
      { sku: "222", name: "מכנס ג׳ינס",   price: "₪75"  },
      { sku: "333", name: "שמלת ערב",     price: "₪120" },
      { sku: "444", name: "מעיל חורף",    price: "₪200" }
      // أضف هنا: { sku: "123456", name: "اسم רנואר", price: "₪XXX" },
    ];

    const $ = id => document.getElementById(id);
    const input = $("q"), frame = $("renFrame"), msg = $("msg"), priceBox = $("priceBox"), dbg = $("debugLink");

    // إزالة تشكيل عبري (ניקוד) ومسافات شاذة
    function stripHebrewNiqqud(s){
      return s.replace(/[\u0591-\u05C7]/g,'');
    }
    function safeQuery(){
      let s = (input.value || '').trim();
      s = stripHebrewNiqqud(s);
      s = s.replace(/\s+/g,' ').trim();             // مسافة واحدة
      s = s.replace(/[^\dA-Za-z\u0590-\u05FF\s\-]/g,''); // أرقام/حروف/عبري/مسافة/شرطة
      return s;
    }
    function renuarUrl(q){
      return "https://www.renuar.co.il/catalogsearch/result/?q=" + encodeURIComponent(q);
    }
    function setMsg(cls,text){ msg.className = cls; msg.textContent = text; }
    function showDebug(url){
      dbg.innerHTML = url ? ('🔗 رابط البحث: <a href="'+url+'" target="_blank" rel="noopener">'+url+'</a>') : '';
    }

    // مطابقة بالسكو/بالاسم محليًا
    function localFind(q){
      const s = q.trim();
      if(!s) return null;
      if(/^\d+$/.test(s)) return CATALOG.find(p => p.sku === s) || null;  // كلّه أرقام → SKU
      const low = s.toLowerCase();
      return CATALOG.find(p => p.name.toLowerCase().includes(low)) || null;
    }

    // السعر المحلي
    function checkPrice(){
      const q = safeQuery();
      showDebug( renuarUrl(q) );
      if(!q){ setMsg("err","נא להזין שם פריט או מק״ט"); priceBox.textContent=""; return; }
      const item = localFind(q);
      if(item){
        priceBox.className="ok";
        priceBox.textContent = 💰 ${item.price} — ${item.name} (SKU ${item.sku});
        setMsg("muted","נמצא במחירון המקומי.");
      }else{
        priceBox.className="err";
        priceBox.textContent = "ℹ לא נמצא במחירון המקומי — أضفه لـ CATALOG إن أردت عرض سعره هنا.";
        setMsg("muted","אפשר עדיין לחפש באתר רנואר בקישורים أعلاه.");
      }
    }

    // البحث داخل إطار (قد يُحجب)
    function searchInFrame(){
      const q = safeQuery();
      const url = renuarUrl(q);
      showDebug(url);
      if(!q){ setMsg("err","נא להזין שם פריט או מק״ט"); return; }
      frame.src = url;
      frame.style.display = "block";
      setMsg("muted","טוען תוצאות מרנואר… (إن لم تظهر، افتح في تبويب)");
    }

    // فتح في تبويب جديد
    function openNew(){
      const q = safeQuery();
      const url = renuarUrl(q);
      showDebug(url);
      if(!q){ setMsg("err","נא להזין שם פריט או מק״ט"); return; }
      window.open(url, "_blank", "noopener");
    }

    // فتح في نفس التبويب (أقوى ضد إعادة التوجيه للـHome)
    function openSame(){
      const q = safeQuery();
      const url = renuarUrl(q);
      showDebug(url);
      if(!q){ setMsg("err","נא להזין שם פריט או מק״ט"); return; }
      window.location.href = url;
    }

    function clearAll(){
      input.value = "";
      frame.removeAttribute("src");
      frame.style.display = "none";
      priceBox.textContent = "";
      showDebug("");
      setMsg("muted","טיפ: Enter يفحص السعر ويجهّز رابط البحث.");
      input.focus();
    }

    // Enter: يفحص + يجهّز الرابط (ولا يغيّر الصفحة)
    input.addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){ e.preventDefault(); checkPrice(); }
    });
  </script>
</body>
</html>
