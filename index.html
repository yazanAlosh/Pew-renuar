<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>×—×™×¤×•×© ×¤×¨×™×˜ / ××§×´×˜ + ×¨× ×•××¨</title>
  <style>
    :root{--blue:#007bff;--blue2:#0056b3;--text:#222;--muted:#666;--bg:#ffffff;--card:#fff;--radius:12px}
    *{box-sizing:border-box}html,body{margin:0;padding:0}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial;background:var(--bg);color:var(--text);line-height:1.5}
    header{background:linear-gradient(90deg,var(--blue),var(--blue2));color:#fff;text-align:center;padding:16px 20px;box-shadow:0 2px 10px rgba(0,0,0,.12)}
    header h1{margin:6px 0 0;font-size:clamp(18px,2.6vw,26px)}
    .wrap{max-width:980px;margin:18px auto;padding:12px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 8px 24px rgba(0,0,0,.08);padding:clamp(14px,3vw,24px);margin-bottom:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:stretch}
    input[type=text]{flex:1;min-width:230px;padding:12px;border:1px solid #dcdcdc;border-radius:10px;font-size:16px;outline:0;box-shadow:inset 0 2px 4px rgba(0,0,0,.03)}
    input[type=text]:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(0,123,255,.12), inset 0 2px 4px rgba(0,0,0,.03)}
    button{background:var(--blue);color:#fff;border:0;border-radius:10px;padding:12px 18px;font-size:16px;font-weight:600;cursor:pointer;box-shadow:0 6px 16px rgba(0,123,255,.35);transition:background .2s,transform .05s}
    button:hover{background:var(--blue2)}button:active{transform:translateY(1px)}
    .ghost{background:#fff;color:var(--blue);border:1px solid #dcdcdc;box-shadow:none}
    .muted{color:var(--muted);font-size:14px;margin-top:6px}
    .ok{color:#118a2c;font-weight:700;margin-top:8px}
    .err{color:#c0392b;font-weight:700;margin-top:8px}
    iframe{width:100%;height:65vh;border:1px solid #eee;border-radius:10px;background:#fff;display:none;margin-top:10px}
    .pill{display:inline-block;background:#eef4ff;color:#1f4fd1;padding:6px 10px;border-radius:999px;font-size:13px}
    .list{margin-top:10px}
    .list .item{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px dashed #eee}
    .item img{width:48px;height:48px;object-fit:cover;border-radius:8px;border:1px solid #eee}
    .item .meta{font-size:14px;color:#444}
    /* Admin */
    details.admin summary{cursor:pointer}
    .admin .row{margin-top:8px}
    textarea{width:100%;min-height:180px;border:1px solid #dcdcdc;border-radius:10px;padding:10px;font-family:ui-monospace,Menlo,Consolas,monospace}
    .hint{font-size:12px;color:#888;margin-top:6px}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .count{font-weight:700}
  </style>
</head>
<body>
  <header>
    <h1>×—×™×¤×•×© ×¤×¨×™×˜ / ××§×´×˜ + ×—×™×¤×•×© ×‘××ª×¨ ×¨× ×•××¨</h1>
  </header>

  <main class="wrap">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
    <section class="card">
      <div class="row">
        <input id="q" type="text" placeholder="×”×›× ×¡ ×©× ×¤×¨×™×˜ ××• ××§×´×˜">
        <button type="button" onclick="doLocal()">×‘×“×•×§ ××—×™×¨ (××§×•××™)</button>
        <button type="button" class="ghost" onclick="searchInFrame()">×—×¤×© ×‘×¨× ×•××¨ (×‘××¡×’×¨×ª)</button>
        <button type="button" class="ghost" onclick="openNew()">×¤×ª×— ×‘×˜××‘ ×—×“×©</button>
        <button type="button" class="ghost" onclick="openSame()">×¤×ª×— ×‘××•×ª×• ×˜××‘</button>
        <button type="button" class="ghost" onclick="clearAll()">× ×§×”</button>
      </div>
      <div id="msg" class="muted">×˜×™×¤: Enter ÙŠÙØ­Øµ Ø§Ù„Ø³Ø¹Ø± Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆÙŠØ¬Ù‡Ù‘Ø² Ø±Ø§Ø¨Ø· ×¨× ×•××¨.</div>
      <div id="priceBox"></div>
    </section>

    <!-- Ù†ØªØ§Ø¦Ø¬ ×¨× ×•××¨ -->
    <section class="card">
      <strong>×ª×•×¦××•×ª ×‘××ª×¨ ×¨× ×•××¨ (×‘××¡×’×¨×ª):</strong>
      <iframe id="renFrame" title="×ª×•×¦××•×ª ×—×™×¤×•×© ×¨× ×•××¨"></iframe>
      <div class="muted">Ø¥Ù† Ù„Ù… ÙŠØ¸Ù‡Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø·Ø§Ø± (Ø¨Ø³Ø¨Ø¨ Ø³ÙŠØ§Ø³Ø§Øª IFRAME)ØŒ Ø§Ø³ØªØ®Ø¯Ù… ÙØªØ­ ÙÙŠ ØªØ¨ÙˆÙŠØ¨/Ù†ÙØ³ Ø§Ù„ØªØ¨ÙˆÙŠØ¨.</div>
    </section>

    <!-- Ù†ØªØ§Ø¦Ø¬ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Ù…Ù† Ù…Ù„ÙÙƒ) -->
    <section class="card">
      <div class="pill">×ª×•×¦××•×ª ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™× ×”××§×•××™</div>
      <div id="localList" class="list"></div>
      <div class="muted">Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªØ£ØªÙŠ Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø°ÙŠ ØªØ±ÙØ¹Ù‡ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø£Ø¯Ù†Ø§Ù‡.</div>
    </section>

    <!-- Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ±: Ø±ÙØ¹ CSV/JSON ÙˆØªØ®Ø²ÙŠÙ†Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ -->
    <section class="card">
      <details class="admin">
        <summary><strong>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± (ØªØ­Ù…ÙŠÙ„/ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ ×”×¤×¨×™×˜×™×)</strong></summary>
        <div class="toolbar">
          <input type="file" id="fileInput" accept=".csv,.json">
          <button class="ghost" type="button" onclick="importFile()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù</button>
          <button class="ghost" type="button" onclick="exportJSON()">ØªØµØ¯ÙŠØ± JSON</button>
          <button class="ghost" type="button" onclick="wipe()">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
          <span class="count">Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®Ø²Ù‘Ù†Ø©: <span id="cnt">0</span></span>
        </div>

        <div class="row">
          <textarea id="pasteBox" placeholder='Ø£Ù„ØµÙ‚ Ù‡Ù†Ø§ CSV Ø£Ùˆ JSON Ø«Ù… Ø§Ø¶ØºØ· "Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ø§Ù„Ù†Øµ"'></textarea>
        </div>
        <div class="toolbar">
          <button type="button" onclick="importFromText()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ø§Ù„Ù†Øµ</button>
          <button type="button" class="ghost" onclick="fillExample()">Ù…Ù„Ø¡ Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹</button>
        </div>
        <div class="hint">
          <div><strong>ØµÙŠØºØ© CSV Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©:</strong> Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† (Ø£Ùˆ Ø£ÙˆÙ„ Ø³Ø·Ø±): <code>sku,name,price,link,img</code></div>
          <div>Ù…Ø«Ø§Ù„: <code>123456,×—×•×œ×¦×ª ×‘×™×™×¡×™×§,â‚ª59.90,https://www.renuar.co.il/...,https://...</code></div>
          <div>ØµÙŠØºØ© JSON Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: Ù…ØµÙÙˆÙØ© Ù…Ù† ÙƒØ§Ø¦Ù†Ø§Øª: <code>[{"sku":"123","name":"×©×","price":"â‚ªX","link":"...","img":"..."}]</code></div>
          <div>ØªÙØ®Ø²Ù‘ÙÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙÙ‘Ø­ (localStorage). Ù„Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬ØŒ Ø§Ø³ØªÙˆØ±Ø¯ Ù…Ù„ÙÙ‹Ø§ ÙƒØ§Ù…Ù„Ù‹Ø§ Ù…Ù† Ù†Ø¸Ø§Ù…Ùƒ/Ù…ÙˆØ±Ø¯Ùƒ.</div>
        </div>
      </details>
    </section>
  </main>

  <script>
    // ====== ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ ======
    const KEY = "CATALOG_FULL";
    const $ = id => document.getElementById(id);
    const input = $("q"), frame = $("renFrame"), msg = $("msg"), priceBox = $("priceBox"), list = $("localList"), cnt = $("cnt");

    function setMsg(cls,text){ msg.className=cls; msg.textContent=text; }
    function clearAll(){
      input.value=""; frame.removeAttribute("src"); frame.style.display="none";
      priceBox.textContent=""; list.innerHTML=""; setMsg("muted","ØªÙ… Ø§Ù„Ù…Ø³Ø­. Ø§ÙƒØªØ¨ Ø§Ø³Ù…/××§×´×˜ Ø¬Ø¯ÙŠØ¯.");
      input.focus();
    }

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„: Ø£Ø±Ù‚Ø§Ù…/Ø­Ø±ÙˆÙ/Ø¹Ø¨Ø±ÙŠ ÙˆÙ…Ø³Ø§ÙØ§Øª
    function stripHebrewNiqqud(s){ return s.replace(/[\u0591-\u05C7]/g,''); }
    function safeQuery(){
      let s = (input.value||"").trim();
      s = stripHebrewNiqqud(s).replace(/\s+/g," ").trim();
      s = s.replace(/[^\dA-Za-z\u0590-\u05FF\s\-]/g,"");
      return s;
    }

    // ====== Ø¨Ø­Ø« Ù…Ø­Ù„ÙŠ ======
    function getDB(){
      try{ return JSON.parse(localStorage.getItem(KEY) || "[]"); }catch(_){ return []; }
    }
    function setDB(arr){
      localStorage.setItem(KEY, JSON.stringify(arr||[]));
      cnt.textContent = (arr||[]).length;
    }
    function refreshCount(){ cnt.textContent = getDB().length; }

    function searchLocal(q){
      const db = getDB();
      if(!q) return [];
      const s = q.trim();
      if(/^\d+$/.test(s)){
        return db.filter(p => (p.sku||"").toString().trim() === s);
      }
      const low = s.toLowerCase();
      return db.filter(p => (p.name||"").toLowerCase().includes(low));
    }

    function renderLocalResults(items){
      list.innerHTML = "";
      if(!items.length){ list.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.</div>'; return; }
      const frag = document.createDocumentFragment();
      items.forEach(p=>{
        const div = document.createElement("div");
        div.className = "item";
        const img = document.createElement("img");
        img.src = p.img || "https://via.placeholder.com/80x80?text=IMG";
        img.alt = p.name || p.sku || "item";
        const meta = document.createElement("div");
        meta.className = "meta";
        meta.innerHTML = `<div><strong>${p.name||""}</strong></div>
                          <div>SKU: ${p.sku||"-"} â€” <strong>${p.price||"-"}</strong></div>
                          ${p.link? <div><a href="${p.link}" target="_blank" rel="noopener">ÙØªØ­ ØµÙØ­Ø© ×¨× ×•××¨</a></div>:""}`;
        div.appendChild(img); div.appendChild(meta);
        frag.appendChild(div);
      });
      list.appendChild(frag);
    }

    function doLocal(){
      const q = safeQuery();
      if(!q){ setMsg("err","× × ×œ×”×–×™×Ÿ ×©× ×¤×¨×™×˜ ××• ××§×´×˜"); priceBox.textContent=""; list.innerHTML=""; return; }
      const items = searchLocal(q);
      if(items.length){
        const first = items[0];
        priceBox.className="ok";
        priceBox.textContent = ğŸ’° ${first.price||"-"} â€” ${first.name||""} (SKU ${first.sku||"-"});
        renderLocalResults(items);
        setMsg("muted","Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ù…Ø­Ù„ÙŠØ©.");
      }else{
        priceBox.className="err";
        priceBox.textContent = "â„¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ù…Ø­Ù„ÙŠØ© â€” Ø§Ø³ØªÙˆØ±Ø¯ Ù…Ù„Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„.";
        renderLocalResults([]);
        setMsg("muted","ÙŠÙ…ÙƒÙ†Ùƒ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ×¨× ×•××¨ Ø¨Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ø§Ù‡.");
      }
    }

    // ====== Ø±× ×•××¨ ======
    function renUrl(q){ return "https://www.renuar.co.il/catalogsearch/result/?q="+encodeURIComponent(q); }
    function searchInFrame(){
      const q = safeQuery();
      if(!q){ setMsg("err","× × ×œ×”×–×™×Ÿ ×©× ×¤×¨×™×˜ ××• ××§×´×˜"); return; }
      frame.src = renUrl(q); frame.style.display="block";
      setMsg("muted","×˜×•×¢×Ÿ ×ª×•×¦××•×ª ××¨× ×•××¨â€¦");
    }
    function openNew(){
      const q = safeQuery();
      if(!q){ setMsg("err","× × ×œ×”×–×™×Ÿ ×©× ×¤×¨×™×˜ ××• ××§×´×˜"); return; }
      window.open(renUrl(q), "_blank", "noopener");
    }
    function openSame(){
      const q = safeQuery();
      if(!q){ setMsg("err","× × ×œ×”×–×™×Ÿ ×©× ×¤×¨×™×˜ ××• ××§×´×˜"); return; }
      window.location.href = renUrl(q);
    }

    // Enter
    input.addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); doLocal(); } });

    // ====== Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ± ======
    function parseCSV(text){
      // Ø¨Ø³ÙŠØ·: ÙŠÙØªØ±Ø¶ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: sku,name,price,link,img
      const lines = text.trim().split(/\r?\n/);
      if(!lines.length) return [];
      // Ø¥Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø£ÙˆÙ„ Ø¹Ù†Ø§ÙˆÙŠÙ†â€”ØªØ¬Ø§ÙˆØ²Ù‡
      const head = lines[0].toLowerCase();
      let start = 0;
      if(head.includes("sku") && head.includes("name")) start = 1;
      const out = [];
      for(let i=start;i<lines.length;i++){
        const row = lines[i].split(",");
        if(!row.length) continue;
        const [sku,name,price,link,img] = row.map(s=> (s||"").trim());
        if(!sku && !name) continue;
        out.push({ sku, name, price, link, img });
      }
      return out;
    }

    function importFile(){
      const f = $("fileInput").files[0];
      if(!f){ alert("Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ø£ÙˆÙ„Ù‹Ø§"); return; }
      const reader = new FileReader();
      reader.onload = e=>{
        let data = [];
        if(f.name.toLowerCase().endsWith(".json")){
          try{ data = JSON.parse(e.target.result||"[]"); }catch(err){ alert("JSON ØºÙŠØ± ØµØ§Ù„Ø­"); return; }
        }else{
          data = parseCSV(e.target.result||"");
        }
        if(!Array.isArray(data)){ alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ØµÙÙˆÙØ©"); return; }
        const db = getDB().concat(data);
        setDB(db);
        alert("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: "+data.length+" Ø¹Ù†ØµØ±Ù‹Ø§");
      };
      reader.readAsText(f, "utf-8");
    }

    function importFromText(){
      const txt = $("pasteBox").value||"";
      let data = [];
      try{
        if(txt.trim().startsWith("[")) data = JSON.parse(txt);
        else data = parseCSV(txt);
      }catch(_){ alert("ØªÙ†Ø³ÙŠÙ‚ ØºÙŠØ± ØµØ§Ù„Ø­"); return; }
      if(!Array.isArray(data)){ alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ØµÙÙˆÙØ©"); return; }
      const db = getDB().concat(data);
      setDB(db);
      alert("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ø§Ù„Ù†Øµ: "+data.length+" Ø¹Ù†ØµØ±Ù‹Ø§");
    }

    function exportJSON(){
      const db = getDB();
      const blob = new Blob([JSON.stringify(db,null,2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "catalog.json";
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function wipe(){
      if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©ØŸ")){ setDB([]); alert("ØªÙ… Ø§Ù„Ù…Ø³Ø­"); }
    }

    function fillExample(){
      const example = [
        {"sku":"111","name":"×—×•×œ×¦×ª ×‘×™×™×¡×™×§","price":"â‚ª50","link":"","img":""},
        {"sku":"222","name":"××›× ×¡ ×’×³×™× ×¡","price":"â‚ª75","link":"","img":""},
        {"sku":"333","name":"×©××œ×ª ×¢×¨×‘","price":"â‚ª120","link":"","img":""},
        {"sku":"444","name":"××¢×™×œ ×—×•×¨×£","price":"â‚ª200","link":"","img":""}
      ];
      $("pasteBox").value = "sku,name,price,link,img\n111,×—×•×œ×¦×ª ×‘×™×™×¡×™×§,â‚ª50,,\n222,××›× ×¡ ×’×³×™× ×¡,â‚ª75,,\n333,×©××œ×ª ×¢×¨×‘,â‚ª120,,\n444,××¢×™×œ ×—×•×¨×£,â‚ª200,,";
      setDB(example);
      alert("ØªÙ… Ù…Ù„Ø¡ Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹ + ØªØ®Ø²ÙŠÙ†Ù‡. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¶Ø§ÙØ© ÙƒÙ…Ø§ ØªØ±ÙŠØ¯.");
    }

    // init
    refreshCount();
  </script>
</body>
</html>
